<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/deco-docs/blog/rss.xml" title="DeCo Education RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/deco-docs/blog/atom.xml" title="DeCo Education Atom Feed"><title data-rh="true">Lesson 3. Hands-On - Creating Tx via App Kit | DeCo Education</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://deco-education.github.io/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lesson 3. Hands-On - Creating Tx via App Kit | DeCo Education"><meta data-rh="true" name="description" content="We will use this proxy contract and Ergo AppKit to write the off-chain code for the transaction."><meta data-rh="true" property="og:description" content="We will use this proxy contract and Ergo AppKit to write the off-chain code for the transaction."><link data-rh="true" rel="icon" href="/deco-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://deco-education.github.io/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit"><link data-rh="true" rel="alternate" href="https://deco-education.github.io/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit" hreflang="en"><link data-rh="true" rel="alternate" href="https://deco-education.github.io/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit" hreflang="x-default"><link rel="stylesheet" href="/deco-docs/assets/css/styles.075a81d0.css">
<link rel="preload" href="/deco-docs/assets/js/runtime~main.60300739.js" as="script">
<link rel="preload" href="/deco-docs/assets/js/main.d7255964.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/deco-docs/"><div class="navbar__logo"><img src="/deco-docs/img/logo.svg" alt="DeCo Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/deco-docs/img/logo.svg" alt="DeCo Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">DeCo</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/deco-docs/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/deco-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/deco-education/deco-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/deco-docs/docs/intro">What is DeCo</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/deco-docs/docs/category/calling-all-cabin-leaders">Calling all Cabin Leaders</a><button aria-label="Toggle the collapsible sidebar category &#x27;Calling all Cabin Leaders&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/deco-docs/docs/category/adventure-guide-book">Adventure Guide Book</a><button aria-label="Toggle the collapsible sidebar category &#x27;Adventure Guide Book&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/deco-docs/docs/category/into-the-woods">Into the Woods</a><button aria-label="Toggle the collapsible sidebar category &#x27;Into the Woods&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/deco-docs/docs/category/prepwork-what-is-blockchain">Prepwork: What is Blockchain</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prepwork: What is Blockchain&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/deco-docs/docs/category/trail-1-eutxo--nfts">Trail 1: eUTxO &amp; NFTs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Trail 1: eUTxO &amp; NFTs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/deco-docs/docs/category/trail-2-ergo-dapp-development">Trail 2: Ergo dApp Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Trail 2: Ergo dApp Development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/dapp-components">DApp Components - Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/t-Ergo Syntax">Tips - Ergo Syntax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/k-development-env-set-up-scala">WIP Lesson 1. Knowledge - Env Set Up (Scala)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/k-development-env-set-up-js">WIP Lesson 1.1. Knowledge - Development Env Set Up (JavaScript)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/k-ergo-appkit-basics">Lesson 2. Knowledge - Ergo Appkit Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-creating-tx-via-app-kit">Lesson 3. Hands-On - Creating Tx via App Kit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-your-first-token">Lesson 4. Hands-On - Your First Token</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-your-first-nft">WIP Lesson 5. Hands-On - Your first NFT</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/deco-docs/docs/category/trail-3-multi-stage-txs--smart-contracts">Trail 3: Multi-Stage Txs &amp; Smart Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Trail 3: Multi-Stage Txs &amp; Smart Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/deco-docs/docs/category/waterfall-1-basic-design-principles">Waterfall 1: Basic Design Principles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Waterfall 1: Basic Design Principles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/deco-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/deco-docs/docs/category/into-the-woods"><span itemprop="name">Into the Woods</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/deco-docs/docs/category/trail-2-ergo-dapp-development"><span itemprop="name">Trail 2: Ergo dApp Development</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lesson 3. Hands-On - Creating Tx via App Kit</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Lesson 3: Hands-On - Creating Tx via App Kit</h1><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">Completion Status</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Version: 1st Version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Written by: LGD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Recall the Alcohol Sale Proxy Contract from Lesson 1 in Ergo Syntax</h1><p>We will use this proxy contract and Ergo AppKit to write the off-chain code for the transaction.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ====== Alcohol Sale Proxy Contract Example ====== //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Hard-coded constants expected at compile time are written in UpperCamelCase.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // INPUTS:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // license          = INPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // buyerProxyInputs = INPUTS - INPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // OUTPUTS:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // storeBox              = OUTPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // provincialSalesTaxBox = OUTPUTS(1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // federalSalesTaxBox    = OUTPUTS(2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // buyerWalletBox        = OUTPUTS(3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // minerFeeBox           = OUTPUTS(4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // (*) Note:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //           1. Mining fee box is always the last box in the set of OUTPUTS of a transaction,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //              I am just showing this for clarity, but it will not be accessed in this contract.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //           2. If there is any that change remains in the proxy,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //                          it is sent back to the buyer wallet.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Contract variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val buyerPK: SigmaProp          = PK(buyerPKString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val buyerProxyInputs: Coll[Box] = INPUTS.filter({ (input: Box) =&gt; input.propositionBytes == SELF.propositionBytes })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val buyerAmount: Long           = buyerProxyInputs.fold(0L)({ (input: Box, acc: Long) =&gt; acc + input.value })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val provincialSalesTax: Long    = (AlcoholSaleAmount * ProvincialSalesTaxNum) / ProvincialSalesTaxDenom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val federalSalesTax: Long       = (AlcoholSaleAmount * FederalSalesTaxNum) / FederalSalesTaxDenom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val totalCost: Long             = AlcoholSaleAmount + provincialSalesTax + federalSalesTax + MinerFee</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Variables associated with the buyer&#x27;s license</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val license = INPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val id      = license.R4[Coll[Byte]].get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val name    = license.R5[Coll[Byte]].get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val bDay    = license.R6[Coll[Byte]].get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val address = license.R7[Coll[Byte]].get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val expDate = license.R8[Coll[Byte]].get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Context variables needed for the proxy contract, assuming they are provided correctly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val licenseTemplateContractBytes = getVar[Coll[Byte]](0).get</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Substitute the constants of the license template contract bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // and create the new contract bytes for the buyer&#x27;s license</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val newLicenseContractBytes = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // New positions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newPositions_SigmaProp: Coll[Int] = Coll(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newPositions_Coll_Byte: Coll[Int] = Coll(1, 2, 3, 4, 5)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // New constants</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newConstants_SigmaProp: Coll[SigmaProp] = Coll(buyerPK)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newConstants_Coll_Byte: Coll[Byte] = Coll(id, name, bDay, address, expDate)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // New contract bytes with substituted buyer PK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newContractBytes_SigmaProp = substConstants(licenseTemplateContractBytes, newPositions_SigmaProp, newConstants_SigmaProp)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // New contract bytes with substituted buyer license information</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newContractBytes_Coll_Byte = substConstants(newContractBytes_SigmaProp, newPositions_Coll_Byte, newConstants_Coll_Byte)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val newContractBytes = newContractBytes_Coll_Byte</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        newContractBytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Check for a valid sale</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val validSale = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for a valid license</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val validLicense = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                BuyerLicenseContractBytes == newLicenseContractBytes,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                license.propositionBytes == newLicenseContractBytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for a valid proxy amount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val validProxyAmount = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        buyerAmount &gt;= totalAmount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for a valid store</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val validStore = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val storeBox = OUTPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            storeBox.propBytes == StoreBoxPropositionBytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for valid sales taxes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val validSalesTaxes = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Check for a valid provincial tax</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val validProvincialSalesTax = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                val provincialSalesTaxBox = OUTPUTS(1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    (provincialSalesTaxBox.propositionBytes == ProvincialSalesTaxPK),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    (provincialSalesTaxBox.value &gt;= provincialSalesTax)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Check for a valid federal tax</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val validFederalSalesTax = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                val federalSalesTaxBox = OUTPUTS(2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    (federalSalesTaxBox.propositionBytes == FederalSalesTaxPK),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    (federalSalesTaxBox.value &gt;= federalSalesTax)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      // Demand that both sales taxes are valid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        validProvincialSalesTax,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        validFederalSalesTax</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for a valid buyer wallet to return any change</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val validBuyerWallet = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (buyerAmount &gt; totalCost) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                val buyerWalletBox = OUTPUTS(3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                buyerWalletBox.propositionBytes == buyerPK.propBytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Demand that all the conditions are valid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            validLicense,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            validProxyAmount,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            validStore,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            validSalesTaxes,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            validBuyerWallet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Check for a valid refund</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val validRefund = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val refundWalletBox = OUTPUTS(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        allOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            (refundWalletBox.propositionBytes == buyerPK.propBytes),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            (refundWalletBox.value &gt;= buyerAmount - MinerFee)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Obtain the appropriate sigma proposition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sigmaProp(anyOf(Coll(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        validSale,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        validRefund</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Assumptions</h1><ol><li>We know the PK and mnemonic of the buyer</li><li>We know the proxy address</li><li>We know the license address</li><li>We know the PK of the store</li><li>We know the provincial and federal government PKs</li></ol><p><strong>Real-world solutions to the assumptions:</strong></p><ol><li>Using ErgoPay you could create an unsigned transaction with a QR code that requests as input the user’s PK and outputs a proxy box, guarded at the above contract, and with the funds needed for the sale.</li><li>Again using ErgoPay, another unsigned transaction could be created to request the user for the proxy address and the pay-2-script address of the license box. Internally, you would search for both and verify the information within the license box.</li><li>Alternatively, you could avoid using a proxy contract with ErgoPay and just request the user for their PK and P2S address of the license box, and place the proxy contract logic directly within your ErgoPay backend.</li><li>With a digitial identity solution, instead of the P2S address, it could be some sort of ZK-Proof that the application uses to ensure the validity of the user’s identity. As wallets enable dApp integration in the future, requiring payment with some sort of identity verification may become possible.</li><li>The store and government PKs would in reality be a P2S address proxy contract such that conditions could be placed in order to enforce who was able to spend the box. For example, one could imagine using a threshold signature scheme in these contracts.</li></ol><h1>Steps</h1><ol><li>Create the ErgoClient</li><li>Create the BlockchainContext</li><li>Retrieve the transaction Input Boxes<ol><li>Retrieve the license box</li><li>Retrieve the proxy boxes and calculate the sale amount</li></ol></li><li>Calculate the amount for the two sales taxes</li><li>Create the Context Variables and Extended Inputs</li><li>Create the Transaction Builder</li><li>Create the transaction Output Boxes</li><li>Create the Prover</li><li>Create the Unsigned Transaction</li><li>Sign the transaction and retrieve the transaction id</li></ol><h1>Alcohol Sale Transaction AppKit Code</h1><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// ====== Alcohol Sale Transaction AppKit Example ====== //</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Constants that we assume to know beforehand are written in UpperCamelCase.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Imports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.ergoplatform.appkit._</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import special.collection.Coll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.{util =&gt; ju}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import scala.collection.JavaConverters._</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Step 1: Create the ErgoClient instance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">val ergoClient: ErgoClient = RestApiErgoClient.create(nodeApiUrl, networkType, nodeApiKey, explorerURL)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Step 2: Create the BlockchainContext instance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">val alcoholSalteTxId: String = ergoClient.execute( (ctx: BlockchainContext) =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Convert the base58 address strings to an Address type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val buyerPKAddress: Address             = Address.create(BuyerPKAddressString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val saleProxyContractAddress: Address   = Address.create(SaleProxyContractAddressString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val licenseAddress: Address             = Address.create(LicenseAddressString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val storePKAddres: Addres               = Address.create(StorePKAddress)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val provincialSalesTaxPKAddres: Address = Address.create(ProvincialSalesTaxPKString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val federalSalesTaxPKAddress: Address   = Address.create(FederalSalesTaxPKString)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 3: Retrieve the license box</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val licenseBox: InputBox = ctx.getUnspentBoxesFor(licenseAddress, 0, 1)(0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 4: Retrieve the proxy boxes - max of 5 at a time, could be set to more</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val proxyBoxes: List[InputBox] = ctx.getUnspentBoxesFor(saleProxyContractAddress, 0, 5).asScala.toList</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val buyerAmount: Long = proxyBoxes.foldLeft(OL)((acc: Long, proxyBox: Long) =&gt; acc + proxyBox.getValue())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 5: Calculate the amount for the two sales taxes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val provincialSalesTaxAmount: Long = ProvincialSalesTaxNum * AlocholSaleAmount / ProvincialSaesTaxDenom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val federalSalesTaxAmount: Long = FederalSalesTaxNum * AlcoholSaleAmount / FederalSalesTaxDenom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 6: Create the Context Variables and Extended Inputs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val licenseErgoTreeBytes: ErgoValue[Coll[Byte]] = ErgoValue.of(licenseBox.getErgoTree().bytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val cVar0_licensePropBytes: ContextVar = ContextVar.of(0.toByte, licenseErgoTreeBytes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val extendedProxyInputBoxes: List[InputBox] = proxyBoxes.map(proxyBox =&gt; proxyBox.withContextVars(cVar0_licensePropBytes))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val extendedInputs: ju.List[InputBox] = seqAsJavaList(extendedProxyInputBoxes)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 7: Create the tx builder</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val txBuilder: UnsignedTransactionBuilder = ctx.newTxBuilder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 8: Create the tx output boxes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val storeBox: OutBox = txBuilder.outBoxBuilder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .value(AlcoholSaleAmount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .contract(ctx.newContract(storePKAddress.getErgoAddress().script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val provincialSalesTaxBox: OutBox = txBuilder.outBoxBuilder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .value(provincialSalesTaxAmount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .contract(ctx.newContract(provincialSalesTaxPKAddress.getErgoAddress().script)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val federalSalesTaxBox: OutBox = txBuilder.outBoxBuilder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .value(federalSalesTaxAmount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .contract(ctx.newContract(federalSalesTaxPKAddress.getErgoAddress))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 9: Create the prover</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val prover: ErgoProver = ctx.newProverBuilder()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .withMnemonic(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            SecretString.create(BuyerMnemonic),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            SecretString.empty()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 10: Create the unsigned transaction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val unsignedAlcoholSaleTx: UnsignedTransaction = txBuilder.boxesToSpend(extendedInputs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .outputs(storeBox, provincialSalesTaxBox, federalSalesTaxBox)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .fee(MinerFee)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .sendChangeTo(buyerPKAddress.getErgoAddress)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Step 11: Sign the transaction and retrieve the tx id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val signedAlcoholSaleTx: SignedTransaction = prover.sign(unsignedAlcoholSaleTx)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val alcoholSaleTxId: String = ctx.sendTransaction(signedAlcoholSaleTx)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    alcoholSaleTxId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Refund Transaction</h1><p>The refund transaction follows the similar steps from the sale transaction, except a refund box is created as an output box, with the buyer’s PK as the contract script.</p><p>A change address must also be provided, but this will just be the buyer’s PK as well.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">Cabin Sessions</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">We went through some examples on how to write the appkit code from looking at the ErgoScript for the Alcohol Sale Proxy Contract.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">With your cabin crew, discuss and work on writing the code for the refund transaction.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/k-ergo-appkit-basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lesson 2. Knowledge - Ergo Appkit Basics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/deco-docs/docs/into-the-woods/trail2-ergo-coding/ho-your-first-token"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lesson 4. Hands-On - Your First Token</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/deco-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/AqNU4gpc2a" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/DeCoEducation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/deco-docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/deco-education/deco-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/deco-docs/assets/js/runtime~main.60300739.js"></script>
<script src="/deco-docs/assets/js/main.d7255964.js"></script>
</body>
</html>